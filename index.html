<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maryam's Pastries: Sweet Shooter</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f8d7ba; /* Light pastry background */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            overflow: hidden;
            position: relative;
        }

        #game-container {
            width: 80%;
            max-width: 800px;
            height: 600px;
            background-color: #fff;
            border: 10px solid #e6b380;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #header {
            background-color: #d4ac0d; /* Golden header */
            color: #fff;
            padding: 20px 0;
            text-align: center;
            font-size: 2em;
            font-weight: bold;
            width: 100%;
            border-bottom: 5px solid #b8860b;
            box-sizing: border-box;
        }

        #game-area {
            flex-grow: 1;
            width: 100%;
            position: relative;
            overflow: hidden;
            background-image: url('https://via.placeholder.com/800x450/f0f0f0/ccc?Text=Pastry+Shop+Sky'); /* Placeholder sky */
            background-size: cover;
        }

        #chocolatier-container {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 150px;
            height: 150px;
            background-image: url('https://via.placeholder.com/150x150/8b4513/eee?Text=Chocolatier'); /* Placeholder chocolatier */
            background-size: contain;
            background-repeat: no-repeat;
            background-position: bottom center;
            z-index: 10;
        }

        #piping-bag {
            position: absolute;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 60px;
            background-image: url('https://via.placeholder.com/40x60/fff/000?Text=Pipe'); /* Placeholder piping bag */
            background-size: contain;
            background-repeat: no-repeat;
            background-position: bottom center;
            transform-origin: bottom center;
            z-index: 11;
        }

        .pastry {
            position: absolute;
            width: 50px;
            height: 50px;
            background-size: contain;
            background-repeat: no-repeat;
            animation: fall linear forwards;
            z-index: 5;
        }

        .muffin { background-image: url('https://via.placeholder.com/50x50/a0d9e0/336699?Text=Muffin'); }
        .chocolate-cake { background-image: url('https://via.placeholder.com/50x50/8b4513/fff?Text=Cake'); }
        .chocolate-praline { background-image: url('https://via.placeholder.com/50x50/d2691e/fff?Text=Praline'); border-radius: 50%; }
        .croissant { background-image: url('https://via.placeholder.com/50x50/f4a460/fff?Text=Croissant'); }
        .fruit-tart { background-image: url('https://via.placeholder.com/50x50/ffdab9/8b0000?Text=Tart'); border-radius: 10px; }

        .glowing {
            box-shadow: 0 0 10px 5px yellow;
            border-radius: 5px; /* Apply glow within pastry bounds */
        }

        .shot {
            position: absolute;
            width: 10px;
            height: 20px;
            background-color: white;
            border-radius: 5px;
            z-index: 9;
        }

        @keyframes fall {
            from { top: -50px; }
            to { top: calc(100% + 50px); }
        }

        #ui {
            position: absolute;
            top: 10px;
            left: 10px;
            color: #333;
            font-size: 1.2em;
            font-weight: bold;
            padding: 10px;
            background-color: rgba(255, 255, 255, 0.7);
            border-radius: 8px;
            z-index: 20;
        }

        #shop {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: rgba(255, 255, 255, 0.7);
            padding: 10px;
            border-radius: 8px;
            z-index: 20;
        }

        #shop button {
            padding: 8px 15px;
            margin-top: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            background-color: #d2b48c;
            color: white;
            font-weight: bold;
        }

        #shop button:hover {
            background-color: #a0522d;
        }

        #start-screen, #game-over-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(248, 215, 170, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            color: #8b4513;
            text-align: center;
        }

        #start-screen h1, #game-over-screen h1 {
            font-size: 3em;
            margin-bottom: 20px;
        }

        #start-screen button, #game-over-screen button {
            padding: 15px 30px;
            font-size: 1.5em;
            background-color: #d4ac0d;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        #start-screen button:hover, #game-over-screen button:hover {
            background-color: #b8860b;
        }

        #game-over-screen p {
            font-size: 1.8em;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="header">Maryam's Sweet Shooter</div>
        <div id="game-area">
            <div id="ui">
                <div>Score: <span id="score">0</span></div>
                <div>Coins: <span id="coins">0</span></div>
                <div>Level: <span id="level">1</span></div>
            </div>
            <div id="shop">
                <div>Shop</div>
                <button disabled>Upgrade Piping Bag (100 Coins)</button>
                <button disabled>Buy Auto-Aim (250 Coins)</button>
            </div>
            <div id="chocolatier-container">
                <div id="piping-bag"></div>
            </div>
        </div>

        <div id="start-screen">
            <h1>Maryam's Sweet Shooter</h1>
            <p>Use your piping bag to shoot the glowing pastries!</p>
            <button id="start-button">Start Game</button>
        </div>

        <div id="game-over-screen" style="display:none;">
            <h1>Game Over!</h1>
            <p id="final-score"></p>
            <p id="coins-earned"></p>
            <button id="restart-button">Play Again</button>
        </div>
    </div>

    <script>
        const gameArea = document.getElementById('game-area');
        const chocolatierContainer = document.getElementById('chocolatier-container');
        const pipingBag = document.getElementById('piping-bag');
        const scoreDisplay = document.getElementById('score');
        const coinsDisplay = document.getElementById('coins');
        const levelDisplay = document.getElementById('level');
        const startScreen = document.getElementById('start-screen');
        const startButton = document.getElementById('start-button');
        const gameOverScreen = document.getElementById('game-over-screen');
        const finalScoreDisplay = document.getElementById('final-score');
        const coinsEarnedDisplay = document.getElementById('coins-earned');
        const restartButton = document.getElementById('restart-button');

        let score = 0;
        let coins = 0;
        let level = 1;
        let fallingSpeed = 2; // Base falling speed in pixels per frame
        let pastryDropInterval = 1500; // Base interval between pastry drops in milliseconds
        let gameActive = false;
        let fallingPastries = [];
        const pastryTypes = ['muffin', 'chocolate-cake', 'chocolate-praline', 'croissant', 'fruit-tart'];
        let targetPastry = null;
        const shootSpeed = 10; // Pixels per frame for the shot
        const scoreToLevelUp = 5; // Number of pastries to score to level up

        // Interval IDs for clearing
        let dropInterval;
        let gameUpdateInterval;

        function startGame() {
            score = 0;
            coins = 0;
            level = 1;
            fallingSpeed = 2;
            pastryDropInterval = 1500;
            scoreDisplay.textContent = score;
            coinsDisplay.textContent = coins;
            levelDisplay.textContent = level;
            gameActive = true;
            
            // Clear any existing pastries and intervals
            fallingPastries.forEach(pastry => pastry.remove());
            fallingPastries = [];
            targetPastry = null;
            clearInterval(dropInterval);
            clearInterval(gameUpdateInterval);

            startScreen.style.display = 'none';
            gameOverScreen.style.display = 'none';
            
            dropInterval = setInterval(dropPastry, pastryDropInterval);
            gameUpdateInterval = setInterval(updateGame, 20);
        }

        function endGame() {
            gameActive = false;
            clearInterval(dropInterval);
            clearInterval(gameUpdateInterval);
            
            // Remove any remaining falling pastries
            fallingPastries.forEach(pastry => pastry.remove());
            fallingPastries = [];

            finalScoreDisplay.textContent = `Final Score: ${score}`;
            coinsEarnedDisplay.textContent = `Coins Earned: ${coins}`;
            gameOverScreen.style.display = 'flex';
        }

        function dropPastry() {
            if (!gameActive) return;

            const pastryType = pastryTypes[Math.floor(Math.random() * pastryTypes.length)]; // Randomly pick a pastry type
            const pastry = document.createElement('div');
            pastry.classList.add('pastry', pastryType);
            pastry.style.left = `${Math.random() * (gameArea.offsetWidth - 50)}px`; // Random X position
            gameArea.appendChild(pastry);
            fallingPastries.push(pastry);

            // Randomly make a pastry glow, prioritizing a new target if none exists
            if (!targetPastry || Math.random() < 0.2) { // 20% chance to glow a new one, or if no current target
                if (targetPastry) {
                    targetPastry.classList.remove('glowing'); // Remove glow from old target
                }
                pastry.classList.add('glowing');
                targetPastry = pastry;
            }

            // Individual fall interval for each pastry
            let currentTop = -50;
            const fallLoop = () => {
                if (!gameActive || !pastry.parentNode) {
                    return; // Stop if game is not active or pastry is removed
                }
                currentTop += fallingSpeed;
                pastry.style.top = `${currentTop}px`;

                if (currentTop > gameArea.offsetHeight) {
                    pastry.remove();
                    fallingPastries = fallingPastries.filter(p => p !== pastry);
                    if (pastry === targetPastry) {
                        targetPastry = null; // Clear target if it falls off screen
                    }
                } else {
                    requestAnimationFrame(fallLoop);
                }
            };
            requestAnimationFrame(fallLoop);
        }

        function shootPastry(event) {
            if (!gameActive || !targetPastry) return;

            const pipeRect = pipingBag.getBoundingClientRect();
            const targetRect = targetPastry.getBoundingClientRect();

            // Calculate start and target coordinates relative to game area
            const gameAreaRect = gameArea.getBoundingClientRect();
            const startX = (pipeRect.left + pipeRect.width / 2) - gameAreaRect.left;
            const startY = (pipeRect.top) - gameAreaRect.top; // Shoot from top of piping bag
            const targetX = (targetRect.left + targetRect.width / 2) - gameAreaRect.left;
            const targetY = (targetRect.top + targetRect.height / 2) - gameAreaRect.top;

            const shot = document.createElement('div');
            shot.classList.add('shot');
            shot.style.left = `${startX - 5}px`; // Adjust for shot width
            shot.style.top = `${startY}px`;
            gameArea.appendChild(shot);

            // Calculate direction vector
            const dx = targetX - startX;
            const dy = targetY - startY;
            const distance = Math.sqrt(dx * dx + dy * dy);
            const unitDx = dx / distance;
            const unitDy = dy / distance;

            let currentShotX = startX;
            let currentShotY = startY;

            const shotLoop = () => {
                if (!gameActive || !shot.parentNode || !targetPastry) {
                    shot.remove();
                    return;
                }

                currentShotX += unitDx * shootSpeed;
                currentShotY += unitDy * shootSpeed;

                shot.style.left = `${currentShotX}px`;
                shot.style.top = `${currentShotY}px`;

                // Check for collision with the target pastry
                const currentTargetRect = targetPastry.getBoundingClientRect();
                const shotRect = shot.getBoundingClientRect();

                // Convert shotRect to be relative to gameArea for accurate collision detection
                const relativeShotRect = {
                    left: shotRect.left - gameAreaRect.left,
                    right: shotRect.right - gameAreaRect.left,
                    top: shotRect.top - gameAreaRect.top,
                    bottom: shotRect.bottom - gameAreaRect.top
                };

                // Convert targetRect to be relative to gameArea
                const relativeTargetRect = {
                    left: currentTargetRect.left - gameAreaRect.left,
                    right: currentTargetRect.right - gameAreaRect.left,
                    top: currentTargetRect.top - gameAreaRect.top,
                    bottom: currentTargetRect.bottom - gameAreaRect.top
                };

                if (
                    relativeShotRect.left < relativeTargetRect.right &&
                    relativeShotRect.right > relativeTargetRect.left &&
                    relativeShotRect.top < relativeTargetRect.bottom &&
                    relativeShotRect.bottom > relativeTargetRect.top
                ) {
                    // Hit!
                    score++;
                    coins += 10;
                    scoreDisplay.textContent = score;
                    coinsDisplay.textContent = coins;
                    targetPastry.remove();
                    fallingPastries = fallingPastries.filter(p => p !== targetPastry); // Remove from array
                    targetPastry = null; // Clear the target
                    shot.remove(); // Remove the shot
                    checkLevelUp();
                } else if (currentShotY < -shot.offsetHeight || currentShotX < -shot.offsetWidth || currentShotX > gameArea.offsetWidth) {
                    // Shot went off-screen
                    shot.remove();
                } else {
                    requestAnimationFrame(shotLoop);
                }
            };
            requestAnimationFrame(shotLoop);
        }

        function checkLevelUp() {
            if (score % scoreToLevelUp === 0 && score > 0) {
                level++;
                levelDisplay.textContent = level;
                fallingSpeed += 0.5; // Increase falling speed
                pastryDropInterval = Math.max(500, pastryDropInterval - 100); // Increase drop frequency (minimum 500ms)
                
                // Restart drop interval with new frequency
                clearInterval(dropInterval);
                dropInterval = setInterval(dropPastry, pastryDropInterval);
            }
        }

        // Main game loop for general updates (e.g., checking for missed pastries)
        function updateGame() {
            if (!gameActive) return;

            // Remove pastries that have fallen off the screen
            fallingPastries = fallingPastries.filter(pastry => {
                if (pastry.parentNode && (parseInt(pastry.style.top) || -50) > gameArea.offsetHeight) {
                    pastry.remove();
                    if (pastry === targetPastry) {
                        targetPastry = null; // If the target pastry is missed, clear it
                    }
                    return false; // Remove from array
                }
                return true; // Keep in array
            });

            // If no target pastry, find a new one to glow
            if (!targetPastry && fallingPastries.length > 0) {
                const availablePastries = fallingPastries.filter(p => !p.classList.contains('glowing'));
                if (availablePastries.length > 0) {
                    const newTarget = availablePastries[Math.floor(Math.random() * availablePastries.length)];
                    newTarget.classList.add('glowing');
                    targetPastry = newTarget;
                }
            }
        }

        startButton.addEventListener('click', startGame);
        restartButton.addEventListener('click', startGame);
        gameArea.addEventListener('click', shootPastry); // Event listener for shooting

    </script>
</body>
</html>
